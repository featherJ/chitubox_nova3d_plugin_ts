module.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=16)}([function(t,e){t.exports=require("util")},function(t,e){t.exports=require("zlib")},function(t,e,i){"use strict";t.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("stream")},function(t,e){t.exports=require("path")},function(t,e,i){"use strict";let n=i(0),r=i(4),s=t.exports=function(){r.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};n.inherits(s,r),s.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e}),process.nextTick(function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},s.prototype.write=function(t,e){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let i;return i=Buffer.isBuffer(t)?t:Buffer.from(t,e||this._encoding),this._buffers.push(i),this._buffered+=i.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused},s.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},s.prototype.destroySoon=s.prototype.end,s.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},s.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},s.prototype._processReadAllowingLess=function(t){this._reads.shift();let e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},s.prototype._processRead=function(t){this._reads.shift();let e=0,i=0,n=Buffer.alloc(t.length);for(;e<t.length;){let r=this._buffers[i++],s=Math.min(r.length,t.length-e);r.copy(n,e,0,s),e+=s,s!==r.length&&(this._buffers[--i]=r.slice(s))}i>0&&this._buffers.splice(0,i),this._buffered-=t.length,t.func.call(this,n)},s.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}},function(t,e,i){"use strict";let n=i(8),r=i(9);function s(t,e,i){let n=t*e;return 8!==i&&(n=Math.ceil(n/(8/i))),n}let o=t.exports=function(t,e){let i=t.width,r=t.height,o=t.interlace,h=t.bpp,a=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],o){let t=n.getImagePasses(i,r);for(let e=0;e<t.length;e++)this._images.push({byteWidth:s(t[e].width,h,a),height:t[e].height,lineIndex:0})}else this._images.push({byteWidth:s(i,h,a),height:r,lineIndex:0});this._xComparison=8===a?h:16===a?2*h:1};o.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},o.prototype._unFilterType1=function(t,e,i){let n=this._xComparison,r=n-1;for(let s=0;s<i;s++){let i=t[1+s],o=s>r?e[s-n]:0;e[s]=i+o}},o.prototype._unFilterType2=function(t,e,i){let n=this._lastLine;for(let r=0;r<i;r++){let i=t[1+r],s=n?n[r]:0;e[r]=i+s}},o.prototype._unFilterType3=function(t,e,i){let n=this._xComparison,r=n-1,s=this._lastLine;for(let o=0;o<i;o++){let i=t[1+o],h=s?s[o]:0,a=o>r?e[o-n]:0,l=Math.floor((a+h)/2);e[o]=i+l}},o.prototype._unFilterType4=function(t,e,i){let n=this._xComparison,s=n-1,o=this._lastLine;for(let h=0;h<i;h++){let i=t[1+h],a=o?o[h]:0,l=h>s?e[h-n]:0,f=h>s&&o?o[h-n]:0,d=r(l,a,f);e[h]=i+d}},o.prototype._reverseFilterLine=function(t){let e,i=t[0],n=this._images[this._imageIndex],r=n.byteWidth;if(0===i)e=t.slice(1,r+1);else switch(e=Buffer.alloc(r),i){case 1:this._unFilterType1(t,e,r);break;case 2:this._unFilterType2(t,e,r);break;case 3:this._unFilterType3(t,e,r);break;case 4:this._unFilterType4(t,e,r);break;default:throw new Error("Unrecognised filter type - "+i)}this.write(e),n.lineIndex++,n.lineIndex>=n.height?(this._lastLine=null,this._imageIndex++,n=this._images[this._imageIndex]):this._lastLine=e,n?this.read(n.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}},function(t,e,i){"use strict";let n=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];e.getImagePasses=function(t,e){let i=[],r=t%8,s=e%8,o=(t-r)/8,h=(e-s)/8;for(let t=0;t<n.length;t++){let e=n[t],a=o*e.x.length,l=h*e.y.length;for(let t=0;t<e.x.length&&e.x[t]<r;t++)a++;for(let t=0;t<e.y.length&&e.y[t]<s;t++)l++;a>0&&l>0&&i.push({width:a,height:l,index:t})}return i},e.getInterlaceIterator=function(t){return function(e,i,r){let s=e%n[r].x.length,o=(e-s)/n[r].x.length*8+n[r].x[s],h=i%n[r].y.length;return 4*o+((i-h)/n[r].y.length*8+n[r].y[h])*t*4}}},function(t,e,i){"use strict";t.exports=function(t,e,i){let n=t+e-i,r=Math.abs(n-t),s=Math.abs(n-e),o=Math.abs(n-i);return r<=s&&r<=o?t:s<=o?e:i}},function(t,e,i){"use strict";let n=i(2),r=i(11),s=t.exports=function(t,e){this._options=t,t.checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[n.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[n.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[n.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[n.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[n.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[n.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};s.prototype.start=function(){this.read(n.PNG_SIGNATURE.length,this._parseSignature.bind(this))},s.prototype._parseSignature=function(t){let e=n.PNG_SIGNATURE;for(let i=0;i<e.length;i++)if(t[i]!==e[i])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},s.prototype._parseChunkBegin=function(t){let e=t.readUInt32BE(0),i=t.readUInt32BE(4),s="";for(let e=4;e<8;e++)s+=String.fromCharCode(t[e]);let o=Boolean(32&t[4]);if(this._hasIHDR||i===n.TYPE_IHDR){if(this._crc=new r,this._crc.write(Buffer.from(s)),this._chunks[i])return this._chunks[i](e);o?this.read(e+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+s))}else this.error(new Error("Expected IHDR on beggining"))},s.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},s.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},s.prototype._parseChunkEnd=function(t){let e=t.readInt32BE(0),i=this._crc.crc32();this._options.checkCRC&&i!==e?this.error(new Error("Crc error - "+e+" - "+i)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},s.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},s.prototype._parseIHDR=function(t){this._crc.write(t);let e=t.readUInt32BE(0),i=t.readUInt32BE(4),r=t[8],s=t[9],o=t[10],h=t[11],a=t[12];if(8!==r&&4!==r&&2!==r&&1!==r&&16!==r)return void this.error(new Error("Unsupported bit depth "+r));if(!(s in n.COLORTYPE_TO_BPP_MAP))return void this.error(new Error("Unsupported color type"));if(0!==o)return void this.error(new Error("Unsupported compression method"));if(0!==h)return void this.error(new Error("Unsupported filter method"));if(0!==a&&1!==a)return void this.error(new Error("Unsupported interlace method"));this._colorType=s;let l=n.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:e,height:i,depth:r,interlace:Boolean(a),palette:Boolean(s&n.COLORTYPE_PALETTE),color:Boolean(s&n.COLORTYPE_COLOR),alpha:Boolean(s&n.COLORTYPE_ALPHA),bpp:l,colorType:s}),this._handleChunkEnd()},s.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},s.prototype._parsePLTE=function(t){this._crc.write(t);let e=Math.floor(t.length/3);for(let i=0;i<e;i++)this._palette.push([t[3*i],t[3*i+1],t[3*i+2],255]);this.palette(this._palette),this._handleChunkEnd()},s.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},s.prototype._parseTRNS=function(t){if(this._crc.write(t),this._colorType===n.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(t.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let e=0;e<t.length;e++)this._palette[e][3]=t[e];this.palette(this._palette)}this._colorType===n.COLORTYPE_GRAYSCALE&&this.transColor([t.readUInt16BE(0)]),this._colorType===n.COLORTYPE_COLOR&&this.transColor([t.readUInt16BE(0),t.readUInt16BE(2),t.readUInt16BE(4)]),this._handleChunkEnd()},s.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},s.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/n.GAMMA_DIVISION),this._handleChunkEnd()},s.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},s.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===n.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(e);let i=t-e.length;i>0?this._handleIDAT(i):this._handleChunkEnd()},s.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},s.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}},function(t,e,i){"use strict";let n=[];!function(){for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;n[t]=e}}();let r=t.exports=function(){this._crc=-1};r.prototype.write=function(t){for(let e=0;e<t.length;e++)this._crc=n[255&(this._crc^t[e])]^this._crc>>>8;return!0},r.prototype.crc32=function(){return-1^this._crc},r.crc32=function(t){let e=-1;for(let i=0;i<t.length;i++)e=n[255&(e^t[i])]^e>>>8;return-1^e}},function(t,e,i){"use strict";let n=i(8),r=[function(){},function(t,e,i,n){if(n===e.length)throw new Error("Ran out of data");let r=e[n];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=255},function(t,e,i,n){if(n+1>=e.length)throw new Error("Ran out of data");let r=e[n];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=e[n+1]},function(t,e,i,n){if(n+2>=e.length)throw new Error("Ran out of data");t[i]=e[n],t[i+1]=e[n+1],t[i+2]=e[n+2],t[i+3]=255},function(t,e,i,n){if(n+3>=e.length)throw new Error("Ran out of data");t[i]=e[n],t[i+1]=e[n+1],t[i+2]=e[n+2],t[i+3]=e[n+3]}],s=[function(){},function(t,e,i,n){let r=e[0];t[i]=r,t[i+1]=r,t[i+2]=r,t[i+3]=n},function(t,e,i){let n=e[0];t[i]=n,t[i+1]=n,t[i+2]=n,t[i+3]=e[1]},function(t,e,i,n){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=n},function(t,e,i){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3]}];function o(t,e,i,n,s,o){let h=t.width,a=t.height,l=t.index;for(let t=0;t<a;t++)for(let a=0;a<h;a++){let h=i(a,t,l);r[n](e,s,h,o),o+=n}return o}function h(t,e,i,n,r,o){let h=t.width,a=t.height,l=t.index;for(let t=0;t<a;t++){for(let a=0;a<h;a++){let h=r.get(n),f=i(a,t,l);s[n](e,h,f,o)}r.resetAfterLine()}}e.dataToBitMap=function(t,e){let i,r,s=e.width,a=e.height,l=e.depth,f=e.bpp,d=e.interlace;8!==l&&(i=function(t,e){let i=[],n=0;function r(){if(n===t.length)throw new Error("Ran out of data");let r,s,o,h,a,l,f,d,p=t[n];switch(n++,e){default:throw new Error("unrecognised depth");case 16:f=t[n],n++,i.push((p<<8)+f);break;case 4:f=15&p,d=p>>4,i.push(d,f);break;case 2:a=3&p,l=p>>2&3,f=p>>4&3,d=p>>6&3,i.push(d,f,l,a);break;case 1:r=1&p,s=p>>1&1,o=p>>2&1,h=p>>3&1,a=p>>4&1,l=p>>5&1,f=p>>6&1,d=p>>7&1,i.push(d,f,l,a,h,o,s,r)}}return{get:function(t){for(;i.length<t;)r();let e=i.slice(0,t);return i=i.slice(t),e},resetAfterLine:function(){i.length=0},end:function(){if(n!==t.length)throw new Error("extra data found")}}}(t,l)),r=l<=8?Buffer.alloc(s*a*4):new Uint16Array(s*a*4);let p,c,u=Math.pow(2,l)-1,_=0;if(d)p=n.getImagePasses(s,a),c=n.getInterlaceIterator(s,a);else{let t=0;c=function(){let e=t;return t+=4,e},p=[{width:s,height:a}]}for(let e=0;e<p.length;e++)8===l?_=o(p[e],r,c,f,t,_):h(p[e],r,c,f,i,u);if(8===l){if(_!==t.length)throw new Error("extra data found")}else i.end();return r}},function(t,e,i){"use strict";t.exports=function(t,e,i=!1){let n=e.depth,r=e.width,s=e.height,o=e.colorType,h=e.transColor,a=e.palette,l=t;return 3===o?function(t,e,i,n,r){let s=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=r[t[s]];if(!i)throw new Error("index "+t[s]+" not in palette");for(let t=0;t<4;t++)e[s+t]=i[t];s+=4}}(t,l,r,s,a):(h&&function(t,e,i,n,r){let s=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=!1;if(1===r.length?r[0]===t[s]&&(i=!0):r[0]===t[s]&&r[1]===t[s+1]&&r[2]===t[s+2]&&(i=!0),i)for(let t=0;t<4;t++)e[s+t]=0;s+=4}}(t,l,r,s,h),8===n||i||(16===n&&(l=Buffer.alloc(r*s*4)),function(t,e,i,n,r){let s=Math.pow(2,r)-1,o=0;for(let r=0;r<n;r++)for(let n=0;n<i;n++){for(let i=0;i<4;i++)e[o+i]=Math.floor(255*t[o+i]/s+.5);o+=4}}(t,l,r,s,n))),l}},function(t,e,i){"use strict";let n=i(2),r=i(11),s=i(24),o=i(25),h=i(1),a=t.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||h.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:n.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:n.COLORTYPE_COLOR_ALPHA,-1===[n.COLORTYPE_GRAYSCALE,n.COLORTYPE_COLOR,n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[n.COLORTYPE_GRAYSCALE,n.COLORTYPE_COLOR,n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};a.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},a.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},a.prototype.filterData=function(t,e,i){let r=s(t,e,i,this._options),h=n.COLORTYPE_TO_BPP_MAP[this._options.colorType];return o(r,e,i,this._options,h)},a.prototype._packChunk=function(t,e){let i=e?e.length:0,n=Buffer.alloc(i+12);return n.writeUInt32BE(i,0),n.writeUInt32BE(t,4),e&&e.copy(n,8),n.writeInt32BE(r.crc32(n.slice(4,n.length-4)),n.length-4),n},a.prototype.packGAMA=function(t){let e=Buffer.alloc(4);return e.writeUInt32BE(Math.floor(t*n.GAMMA_DIVISION),0),this._packChunk(n.TYPE_gAMA,e)},a.prototype.packIHDR=function(t,e){let i=Buffer.alloc(13);return i.writeUInt32BE(t,0),i.writeUInt32BE(e,4),i[8]=this._options.bitDepth,i[9]=this._options.colorType,i[10]=0,i[11]=0,i[12]=0,this._packChunk(n.TYPE_IHDR,i)},a.prototype.packIDAT=function(t){return this._packChunk(n.TYPE_IDAT,t)},a.prototype.packIEND=function(){return this._packChunk(n.TYPE_IEND,null)}},function(t,e,i){"use strict";let n=t.exports=function(t){this._buffer=t,this._reads=[]};n.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},n.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let t=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=t.length||t.allowLess))break;{this._reads.shift();let e=this._buffer;this._buffer=e.slice(t.length),t.func.call(this,e.slice(0,t.length))}}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Nova3DPlugin=void 0;const n=i(17),r=i(18),s=i(5),o=i(3),h=i(19);class a{constructor(t){this.tempPath=t,this.gCodeParser=new n.RunGCodeParser,this.gCodeGenerator=new r.GCodeGenerator,this.imageConverter=new h.ImageConverter;try{this.buildGCode(),this.buildImages()}catch(e){o.writeFileSync(s.join(t,"error.log"),e.stack,"utf8")}}buildGCode(){var t=s.join(this.tempPath,"run.gcode");this.gCodeParser.parse(t),this.gCodeGenerator.build(this.gCodeParser.header,this.gCodeParser.start,this.gCodeParser.layers),o.unlinkSync(t);var e=s.join(this.tempPath,"nova3d.gcode");o.writeFileSync(e,this.gCodeGenerator.content,"utf8")}buildImages(){for(var t=[],e=o.readdirSync(this.tempPath),i=0;i<e.length;i++){var n=e[i],r=s.join(this.tempPath,n);".png"==s.extname(r).toLocaleLowerCase()&&-1==n.indexOf("preview")&&t.push(r)}for(i=0;i<t.length;i++)this.imageConverter.convertImage(t[i])}}e.Nova3DPlugin=a;let l=process.argv.splice(2)[0];l&&new a(l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RunGCodeParser=void 0;const n=i(3);e.RunGCodeParser=class{constructor(){}get header(){return this._header}get start(){return this._start}get layers(){return this._layers}parse(t){let e=n.readFileSync(t,"utf8").split(";START_GCODE_BEGIN"),i=e[0],r=e[1].split(";START_GCODE_END"),s=r[0],o=r[1];this.parseHeader(i),this._start=s.trim(),this.parseLayers(o)}parseHeader(t){let e=t.split(";");this._header={};for(let t=0;t<e.length;t++){let i=e[t];if(i=i.trim()){let t=i.split(":"),e=t[0],n=t[1];"fileName"==e&&(n=(n=n.split("#")[0]).trim()),this._header[e]=n}}}parseLayers(t){let e=[],i=t.split(";LAYER_END");for(let t=0;t<i.length;t++){let n=i[t];if(n=n.trim()){if(-1!=n.indexOf(";END_GCODE_BEGIN"))break;if(-1!=n.indexOf(";END_GCODE_END"))break;let t=[],i={},r=n.split("\n"),s=!1;for(let e=0;e<r.length;e++){let n=r[e].trim();if(0==n.indexOf(";LAYER_START:")){let t=n.slice(";LAYER_START:".length);i.index=parseInt(t)}if(0==n.indexOf("G0")&&t.push(n),0==n.indexOf("G4 P")){let t=parseFloat(n.slice("G4 P".length));s?i.exposure_time=t:i.light_delay=t}if(-1!=n.indexOf("light on")){s=!0;let t=n.split(";")[0],e=parseFloat(t.slice("M106 S".length));i.light_pwm=e}}let o=this.parseGData(t[0]),h=this.parseGData(t[1]),a=null,l=null;o.pos>=h.pos?(a=o,l=h):(a=h,l=o),i.rise_pos=a.pos,i.rise_speed=a.speed,i.fall_pos=l.pos,i.fall_speed=l.speed,e.push(i)}}this._layers=e}parseGData(t){let e=t.split(" ");return{pos:parseFloat(e[1].slice(1)),speed:parseFloat(e[2].slice(1))}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GCodeGenerator=void 0,e.GCodeGenerator=class{constructor(){this.transitionLayerStartIndex=0,this.transitionLayerEndIndex=0,this.analyseSuccess=!1,this.startRiseSpeed=-1,this.endRiseSpeed=-1,this.startRiseDist=-1,this.endRiseDist=-1,this.startFallSpeed=-1,this.endFallSpeed=-1,this.startlightDelay=-1,this.endLightDelay=-1,this.startExposureTime=-1,this.endExposureTime=-1}get content(){return this._content}build(t,e,i){this._content="",this.header=t,this.start=e,this.layers=i,this.buildHeader(),this.buildStart(),this.buildLayers(),this.buildLastLayers(),this.buildLast()}buildHeader(){this._content+="; create by plugin (Nova3d Nodejs-TS):1.0.0\n",this._content+=";(****Build and Slicing Parameters****)\n",this._content+=`;(X Resolution            = ${this.header.resolutionX} )\n`,this._content+=`;(Y Resolution            = ${this.header.resolutionY} )\n`,this._content+=`;(Layer Thickness         = ${this.header.layerHeight} mm )\n`,this._content+=`;(Layer Time              = ${1e3*this.header.normalExposureTime} ms )\n`,this._content+=";(Render Outlines         = False\n",this._content+=";(Outline Width Inset     = 2\n",this._content+=";(Outline Width Outset    = 0\n",this._content+=`;(Bottom Layers Time      = ${this.header.bottomLayerExposureTime} ms )\n`,this._content+=`;(Number of Bottom Layers = ${this.header.bottomLayerCount} )\n`,this._content+=";(Blanking Layer Time     = 0 ms )\n",this._content+=";(Build Direction         = Bottom_Up)\n",this._content+=";(Lift Distance           = 5 mm )\n",this._content+=";(Slide/Tilt Value        = 0)\n",this._content+=";(Use Mainlift GCode Tab  = False)\n",this._content+=`;(Wait After Stop         = ${this.header.lightOffTime}s )\n`,this._content+=`;(Z Lift Feed Rate        = ${this.header.normalLayerLiftSpeed} mm/s )\n`,this._content+=`;(Z Bottom Lift Feed Rate = ${this.header.bottomLayerLiftSpeed} mm/s )\n`,this._content+=`;(Z Lift Retract Rate     = ${this.header.normalDropSpeed} mm/s )\n`,this._content+=";(Flip X                  = True)\n",this._content+=";(Flip Y                  = True)\n",this._content+=`;Number of Slices         = ${this.header.totalLayer}\n`,this._content+=";(****Machine Configuration ******)\n",this._content+=`;(Platform X Size         = ${this.header.machineX}mm )\n`,this._content+=`;(Platform Y Size         = ${this.header.machineY}mm )\n`,this._content+=`;(Platform Z Size         = ${this.header.machineZ}mm )\n`,this._content+=";(Max X Feedrate          = 240mm/s )\n",this._content+=";(Max Y Feedrate          = 240mm/s )\n",this._content+=";(Max Z Feedrate          = 240mm/s )\n",this._content+=";(Machine Type            = UV_LCD)\n"}buildStart(){this._content+="\n",this._content+="G28\n",this._content+="G21 ;Set units to be mm\n",this._content+="G91 ;Relative Positioning\n",this._content+="M17 ;Enable motors\n",this._content+="<Slice> Blank\n",this._content+="M106 S0\n"}buildLayers(){this.analyseLayers();for(var t=0;t<this.layers.length;t++)this.buildLayer(this.layers[t])}analyseLayers(){this.analyseSuccess=!1,this.transitionLayerStartIndex=parseInt(this.header.bottomLayerCount);for(var t=this.transitionLayerStartIndex;t<this.layers.length-1;t++){var e=this.layers[t],i=this.layers[t+1];if(e.exposure_time==i.exposure_time){this.transitionLayerEndIndex=t-1;break}}if(this.transitionLayerStartIndex>0&&this.transitionLayerEndIndex>this.transitionLayerStartIndex&&this.transitionLayerEndIndex<this.layers.length-1){var n=null,r=null;try{n=this.layers[this.transitionLayerStartIndex-1],r=this.layers[this.transitionLayerEndIndex+1]}catch(t){}n&&r&&(this.analyseSuccess=!0,this.startRiseSpeed=n.rise_speed,this.endRiseSpeed=r.rise_speed,this.startFallSpeed=n.fall_speed,this.endFallSpeed=r.fall_speed,this.startlightDelay=n.light_delay,this.endLightDelay=r.light_delay,this.startExposureTime=n.exposure_time,this.endExposureTime=r.exposure_time,this.startRiseDist=n.rise_pos-n.fall_pos,this.endRiseDist=r.rise_pos-r.fall_pos)}}getTransitionValue(t,e,i){var n=t+(e-t)/(this.transitionLayerEndIndex+1-(this.transitionLayerStartIndex-1))*(i-(this.transitionLayerStartIndex-1));return Math.floor(10*n)/10}buildLayer(t){this._content+="\n",this._content+=`;<Slice> ${t.index}\n`,this._content+=`M106 S${t.light_pwm}\n`;var e;e=this.analyseSuccess&&t.index>=this.transitionLayerStartIndex&&t.index<=this.transitionLayerEndIndex?this.getTransitionValue(this.startExposureTime,this.endExposureTime,t.index):t.exposure_time,this._content+=`;<Delay> ${e}\n`,this._content+="M106 S0\n",this._content+=";<Slice> Blank\n";var i=0;i=this.analyseSuccess&&t.index>=this.transitionLayerStartIndex&&t.index<=this.transitionLayerEndIndex?this.getTransitionValue(this.startRiseDist,this.endRiseDist,t.index):t.rise_pos-t.fall_pos;var n=parseFloat(this.header.layerHeight)-i;i=Math.ceil(1e7*i)/1e7,n=Math.ceil(1e7*n)/1e7;var r=0,s=0;this.analyseSuccess&&t.index>=this.transitionLayerStartIndex&&t.index<=this.transitionLayerEndIndex?(r=this.getTransitionValue(this.startRiseSpeed,this.endRiseSpeed,t.index),s=this.getTransitionValue(this.startFallSpeed,this.endFallSpeed,t.index)):(r=t.rise_speed,s=t.fall_speed),this._content+=`G1 Z${i} F${r}\n`,this._content+=`G1 Z${n} F${s}\n`;var o=0;o=i/(r/60)*1e3+-n/(s/60)*1e3+(this.analyseSuccess&&t.index>=this.transitionLayerStartIndex&&t.index<=this.transitionLayerEndIndex?this.getTransitionValue(this.startlightDelay,this.endLightDelay,t.index):t.light_delay),o=Math.floor(o),this._content+=`;<Delay> ${o}\n`}buildLastLayers(){var t=parseInt(this.header.totalLayer)-this.layers.length,e={},i=this.layers[this.layers.length-1];e.index=i.index,e.rise_pos=i.rise_pos,e.rise_speed=i.rise_speed,e.fall_pos=i.fall_pos,e.fall_speed=i.fall_speed,e.light_delay=i.light_delay,e.light_pwm=i.light_pwm,e.exposure_time=i.exposure_time;for(var n=0;n<t;n++)e.index++,this.buildLayer(e)}buildLast(){this._content+="\n",this._content+="M18 ;Disable Motors\n",this._content+="M106 S0\n",this._content+="G1 Z80\n",this._content+=";<Completed>\n"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ImageConverter=void 0;const n=i(20),r=i(3),s=i(5);e.ImageConverter=class{constructor(){}convertImage(t){for(var e=r.readFileSync(t),i=n.PNG.sync.read(e),o=Math.floor(i.width/3),h=Math.floor(i.height),a=new n.PNG({width:o,height:h,filterType:-1}),l=0;l<i.height;l++)for(var f=0,d=0;d<i.width;d+=3){var p=i.width*l+d<<2,c=i.width*l+d+1<<2,u=i.width*l+d+2<<2,_=i.data[p],y=i.data[c],g=i.data[u],m=a.width*l+f<<2;a.data[m]=_,a.data[m+1]=y,a.data[m+2]=g,a.data[m+3]=255,f++}for(var b=s.basename(t),E=s.dirname(t),w=parseInt(b.split(".")[0])-1+"";w.length<5;)w="0"+w;var T="nova3d"+w+".png",L=s.join(E,T);r.writeFileSync(L,n.PNG.sync.write(a,{inputHasAlpha:!1})),r.unlinkSync(t)}}},function(t,e,i){"use strict";let n=i(0),r=i(4),s=i(21),o=i(23),h=i(26),a=e.PNG=function(t){r.call(this),t=t||{},this.width=0|t.width,this.height=0|t.height,this.data=this.width>0&&this.height>0?Buffer.alloc(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new s(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(t){this.data=t,this.emit("parsed",t)}.bind(this)),this._packer=new o(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};n.inherits(a,r),a.sync=h,a.prototype.pack=function(){return this.data&&this.data.length?(process.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this):(this.emit("error","No data provided"),this)},a.prototype.parse=function(t,e){if(e){let t,i;t=function(t){this.removeListener("error",i),this.data=t,e(null,this)}.bind(this),i=function(i){this.removeListener("parsed",t),e(i,null)}.bind(this),this.once("parsed",t),this.once("error",i)}return this.end(t),this},a.prototype.write=function(t){return this._parser.write(t),!0},a.prototype.end=function(t){this._parser.end(t)},a.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},a.prototype._gamma=function(t){this.gamma=t},a.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},a.bitblt=function(t,e,i,n,r,s,o,h){if(n|=0,r|=0,s|=0,o|=0,h|=0,(i|=0)>t.width||n>t.height||i+r>t.width||n+s>t.height)throw new Error("bitblt reading outside image");if(o>e.width||h>e.height||o+r>e.width||h+s>e.height)throw new Error("bitblt writing outside image");for(let a=0;a<s;a++)t.data.copy(e.data,(h+a)*e.width+o<<2,(n+a)*t.width+i<<2,(n+a)*t.width+i+r<<2)},a.prototype.bitblt=function(t,e,i,n,r,s,o){return a.bitblt(this,t,e,i,n,r,s,o),this},a.adjustGamma=function(t){if(t.gamma){for(let e=0;e<t.height;e++)for(let i=0;i<t.width;i++){let n=t.width*e+i<<2;for(let e=0;e<3;e++){let i=t.data[n+e]/255;i=Math.pow(i,1/2.2/t.gamma),t.data[n+e]=Math.round(255*i)}}t.gamma=0}},a.prototype.adjustGamma=function(){a.adjustGamma(this)}},function(t,e,i){"use strict";let n=i(0),r=i(1),s=i(6),o=i(22),h=i(10),a=i(12),l=i(13),f=t.exports=function(t){s.call(this),this._parser=new h(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};n.inherits(f,s),f.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},f.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=r.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let t=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,e=Math.max(t,r.Z_MIN_CHUNK);this._inflate=r.createInflate({chunkSize:e});let i=t,n=this.emit.bind(this,"error");this._inflate.on("error",(function(t){i&&n(t)})),this._filter.on("complete",this._complete.bind(this));let s=this._filter.write.bind(this._filter);this._inflate.on("data",(function(t){i&&(t.length>i&&(t=t.slice(0,i)),i-=t.length,s(t))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},f.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new o(this._bitmapInfo)},f.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},f.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},f.prototype._simpleTransparency=function(){this._metaData.alpha=!0},f.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},f.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},f.prototype._complete=function(t){if(this.errord)return;let e;try{let i=a.dataToBitMap(t,this._bitmapInfo);e=l(i,this._bitmapInfo,this._options.skipRescale),i=null}catch(t){return void this._handleError(t)}this.emit("parsed",e)}},function(t,e,i){"use strict";let n=i(0),r=i(6),s=i(7),o=t.exports=function(t){r.call(this);let e=[],i=this;this._filter=new s(t,{read:this.read.bind(this),write:function(t){e.push(t)},complete:function(){i.emit("complete",Buffer.concat(e))}}),this._filter.start()};n.inherits(o,r)},function(t,e,i){"use strict";let n=i(0),r=i(4),s=i(2),o=i(14),h=t.exports=function(t){r.call(this);let e=t||{};this._packer=new o(e),this._deflate=this._packer.createDeflate(),this.readable=!0};n.inherits(h,r),h.prototype.pack=function(t,e,i,n){this.emit("data",Buffer.from(s.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,i)),n&&this.emit("data",this._packer.packGAMA(n));let r=this._packer.filterData(t,e,i);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(r)}},function(t,e,i){"use strict";let n=i(2);t.exports=function(t,e,i,r){let s=-1!==[n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(r.colorType);if(r.colorType===r.inputColorType){let e=function(){let t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256!==new Int16Array(t)[0]}();if(8===r.bitDepth||16===r.bitDepth&&e)return t}let o=16!==r.bitDepth?t:new Uint16Array(t.buffer),h=255,a=n.COLORTYPE_TO_BPP_MAP[r.inputColorType];4!==a||r.inputHasAlpha||(a=3);let l=n.COLORTYPE_TO_BPP_MAP[r.colorType];16===r.bitDepth&&(h=65535,l*=2);let f=Buffer.alloc(e*i*l),d=0,p=0,c=r.bgColor||{};function u(){let t,e,i,a=h;switch(r.inputColorType){case n.COLORTYPE_COLOR_ALPHA:a=o[d+3],t=o[d],e=o[d+1],i=o[d+2];break;case n.COLORTYPE_COLOR:t=o[d],e=o[d+1],i=o[d+2];break;case n.COLORTYPE_ALPHA:a=o[d+1],e=t=o[d],i=t;break;case n.COLORTYPE_GRAYSCALE:e=t=o[d],i=t;break;default:throw new Error("input color type:"+r.inputColorType+" is not supported at present")}return r.inputHasAlpha&&(s||(a/=h,t=Math.min(Math.max(Math.round((1-a)*c.red+a*t),0),h),e=Math.min(Math.max(Math.round((1-a)*c.green+a*e),0),h),i=Math.min(Math.max(Math.round((1-a)*c.blue+a*i),0),h))),{red:t,green:e,blue:i,alpha:a}}void 0===c.red&&(c.red=h),void 0===c.green&&(c.green=h),void 0===c.blue&&(c.blue=h);for(let t=0;t<i;t++)for(let t=0;t<e;t++){let t=u();switch(r.colorType){case n.COLORTYPE_COLOR_ALPHA:case n.COLORTYPE_COLOR:8===r.bitDepth?(f[p]=t.red,f[p+1]=t.green,f[p+2]=t.blue,s&&(f[p+3]=t.alpha)):(f.writeUInt16BE(t.red,p),f.writeUInt16BE(t.green,p+2),f.writeUInt16BE(t.blue,p+4),s&&f.writeUInt16BE(t.alpha,p+6));break;case n.COLORTYPE_ALPHA:case n.COLORTYPE_GRAYSCALE:{let e=(t.red+t.green+t.blue)/3;8===r.bitDepth?(f[p]=e,s&&(f[p+1]=t.alpha)):(f.writeUInt16BE(e,p),s&&f.writeUInt16BE(t.alpha,p+2));break}default:throw new Error("unrecognised color Type "+r.colorType)}d+=a,p+=l}return f}},function(t,e,i){"use strict";let n=i(9),r={0:function(t,e,i,n,r){for(let s=0;s<i;s++)n[r+s]=t[e+s]},1:function(t,e,i,n,r,s){for(let o=0;o<i;o++){let i=o>=s?t[e+o-s]:0,h=t[e+o]-i;n[r+o]=h}},2:function(t,e,i,n,r){for(let s=0;s<i;s++){let o=e>0?t[e+s-i]:0,h=t[e+s]-o;n[r+s]=h}},3:function(t,e,i,n,r,s){for(let o=0;o<i;o++){let h=o>=s?t[e+o-s]:0,a=e>0?t[e+o-i]:0,l=t[e+o]-(h+a>>1);n[r+o]=l}},4:function(t,e,i,r,s,o){for(let h=0;h<i;h++){let a=h>=o?t[e+h-o]:0,l=e>0?t[e+h-i]:0,f=e>0&&h>=o?t[e+h-(i+o)]:0,d=t[e+h]-n(a,l,f);r[s+h]=d}}},s={0:function(t,e,i){let n=0,r=e+i;for(let i=e;i<r;i++)n+=Math.abs(t[i]);return n},1:function(t,e,i,n){let r=0;for(let s=0;s<i;s++){let i=s>=n?t[e+s-n]:0,o=t[e+s]-i;r+=Math.abs(o)}return r},2:function(t,e,i){let n=0,r=e+i;for(let s=e;s<r;s++){let r=e>0?t[s-i]:0,o=t[s]-r;n+=Math.abs(o)}return n},3:function(t,e,i,n){let r=0;for(let s=0;s<i;s++){let o=s>=n?t[e+s-n]:0,h=e>0?t[e+s-i]:0,a=t[e+s]-(o+h>>1);r+=Math.abs(a)}return r},4:function(t,e,i,r){let s=0;for(let o=0;o<i;o++){let h=o>=r?t[e+o-r]:0,a=e>0?t[e+o-i]:0,l=e>0&&o>=r?t[e+o-(i+r)]:0,f=t[e+o]-n(h,a,l);s+=Math.abs(f)}return s}};t.exports=function(t,e,i,n,o){let h;if("filterType"in n&&-1!==n.filterType){if("number"!=typeof n.filterType)throw new Error("unrecognised filter types");h=[n.filterType]}else h=[0,1,2,3,4];16===n.bitDepth&&(o*=2);let a=e*o,l=0,f=0,d=Buffer.alloc((a+1)*i),p=h[0];for(let e=0;e<i;e++){if(h.length>1){let e=1/0;for(let i=0;i<h.length;i++){let n=s[h[i]](t,f,a,o);n<e&&(p=h[i],e=n)}}d[l]=p,l++,r[p](t,f,a,d,l,o),l+=a,f+=a}return d}},function(t,e,i){"use strict";let n=i(27),r=i(32);e.read=function(t,e){return n(t,e||{})},e.write=function(t,e){return r(t,e)}},function(t,e,i){"use strict";let n=!0,r=i(1),s=i(28);r.deflateSync||(n=!1);let o=i(15),h=i(31),a=i(10),l=i(12),f=i(13);t.exports=function(t,e){if(!n)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let i,d,p,c=[],u=new o(t);if(new a(e,{read:u.read.bind(u),error:function(t){i=t},metadata:function(t){d=t},gamma:function(t){p=t},palette:function(t){d.palette=t},transColor:function(t){d.transColor=t},inflateData:function(t){c.push(t)},simpleTransparency:function(){d.alpha=!0}}).start(),u.process(),i)throw i;let _,y=Buffer.concat(c);if(c.length=0,d.interlace)_=r.inflateSync(y);else{let t=(1+(d.width*d.bpp*d.depth+7>>3))*d.height;_=s(y,{chunkSize:t,maxLength:t})}if(y=null,!_||!_.length)throw new Error("bad png - invalid inflate data response");let g=h.process(_,d);y=null;let m=l.dataToBitMap(g,d);g=null;let b=f(m,d,e.skipRescale);return d.data=b,d.gamma=p||0,d}},function(t,e,i){"use strict";let n=i(29).ok,r=i(1),s=i(0),o=i(30).kMaxLength;function h(t){if(!(this instanceof h))return new h(t);t&&t.chunkSize<r.Z_MIN_CHUNK&&(t.chunkSize=r.Z_MIN_CHUNK),r.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function a(t,e){e&&process.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function l(t,e){return function(t,e){if("string"==typeof e&&(e=Buffer.from(e)),!(e instanceof Buffer))throw new TypeError("Not a string or buffer");let i=t._finishFlushFlag;return null==i&&(i=r.Z_FINISH),t._processChunk(e,i)}(new h(e),t)}h.prototype._processChunk=function(t,e,i){if("function"==typeof i)return r.Inflate._processChunk.call(this,t,e,i);let s,h,l=this,f=t&&t.length,d=this._chunkSize-this._offset,p=this._maxLength,c=0,u=[],_=0;function y(t,e){if(l._hadError)return;let i=d-e;if(n(i>=0,"have should not go down"),i>0){let t=l._buffer.slice(l._offset,l._offset+i);if(l._offset+=i,t.length>p&&(t=t.slice(0,p)),u.push(t),_+=t.length,0==(p-=t.length))return!1}return(0===e||l._offset>=l._chunkSize)&&(d=l._chunkSize,l._offset=0,l._buffer=Buffer.allocUnsafe(l._chunkSize)),0===e&&(c+=f-t,f=t,!0)}this.on("error",(function(t){s=t})),n(this._handle,"zlib binding closed");do{h=(h=this._handle.writeSync(e,t,c,f,this._buffer,this._offset,d))||this._writeState}while(!this._hadError&&y(h[0],h[1]));if(this._hadError)throw s;if(_>=o)throw a(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+o.toString(16)+" bytes");let g=Buffer.concat(u,_);return a(this),g},s.inherits(h,r.Inflate),t.exports=e=l,e.Inflate=h,e.createInflate=function(t){return new h(t)},e.inflateSync=l},function(t,e){t.exports=require("assert")},function(t,e){t.exports=require("buffer")},function(t,e,i){"use strict";let n=i(15),r=i(7);e.process=function(t,e){let i=[],s=new n(t);return new r(e,{read:s.read.bind(s),write:function(t){i.push(t)},complete:function(){}}).start(),s.process(),Buffer.concat(i)}},function(t,e,i){"use strict";let n=!0,r=i(1);r.deflateSync||(n=!1);let s=i(2),o=i(14);t.exports=function(t,e){if(!n)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let i=new o(e||{}),h=[];h.push(Buffer.from(s.PNG_SIGNATURE)),h.push(i.packIHDR(t.width,t.height)),t.gamma&&h.push(i.packGAMA(t.gamma));let a=i.filterData(t.data,t.width,t.height),l=r.deflateSync(a,i.getDeflateOptions());if(a=null,!l||!l.length)throw new Error("bad png - invalid compressed data response");return h.push(i.packIDAT(l)),h.push(i.packIEND()),Buffer.concat(h)}}]);